#!/bin/bash

# Start an activity in a given project

# Set project
PROJECT=$1

# Sync from Git if wanted
if [[ $GITSYNC == "yes" ]]; then
    $WD/.gitpull & disown
fi

# Ask for user activity
activity=$($WD/.parseSpaces $(echo -e "What are you doing?\n$(for project in $(ls $PROJECTS/$PROJECT); do $WD/.parseUnderscores $project; done)" | dmenu -i))

# Validate user input
if [[ $activity == "" ]]; then
    echo "You must enter a valid activity name." | dmenu
    $WD/.startActivity $PROJECT
    exit
fi

# Record start time of tracking
START=$(date +%s)

# Write information of running timer to temp
# file for use when stopping timer later
echo "$CLIENT" > $ACTIVE
echo "$activity" >> $ACTIVE
echo "$1" >> $ACTIVE
echo "$START" >> $ACTIVE

# Inform user that timer is running
echo "$($WD/.parseUnderscores $activity)@$($WD/.parseUnderscores $PROJECT) started at $(date --date="@$START")" | dmenu
