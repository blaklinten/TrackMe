#!/bin/bash

clear

if [ ! -f $ACTIVE ]; then
    echo "No timer active, exiting..."
    exit
fi

END=$(date +%s)
ACTIVITY=$(head -n 1 $ACTIVE)
PROJECT=$(head -n 2 $ACTIVE | tail -n 1)
START=$(tail -n 1 $ACTIVE)

echo "Started at $(date --date="@$START")" >> $PROJECTS/$PROJECT/$ACTIVITY
echo "Ended at $(date --date="@$END")" >> $PROJECTS/$PROJECT/$ACTIVITY
echo "Duration: $($WD/.calculateTime "$START" "$END")" >> $PROJECTS/$PROJECT/$ACTIVITY
yes | rm $ACTIVE

# Push to git, if wanted
if [[ $GITSYNC == "true" ]]; then
    $WD/.gitpush $ACTIVITY $PROJECT &
fi

echo "Time entry added to $ACTIVITY!"
